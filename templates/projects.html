<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Projects - SynergySphere</title>
    <link rel="icon" type="image/png" href="/static/img/logo.png">
    <link rel="stylesheet" href="/static/css/style.css">
</head>
<body>
    <div class="floating-spheres">
        <div class="floating-sphere sphere-1"></div>
        <div class="floating-sphere sphere-2"></div>
        <div class="floating-sphere sphere-3"></div>
    </div>
    
    <nav class="navbar">
        <div class="nav-brand">
            <img src="/static/img/logo.png" alt="SynergySphere Logo" class="nav-logo">
            SynergySphere
        </div>
        <div class="nav-menu">
            <a href="/dashboard">Dashboard</a>
            <a href="/projects" style="color: var(--accent);">Projects</a>
            <a href="/profile">Profile</a>
            <a href="#" onclick="logout()" class="btn-outline">Logout</a>
        </div>
    </nav>

    <div class="dashboard-container">
        <div class="dashboard-header">
            <h1>My Projects</h1>
            <button class="btn-primary" onclick="openCreateModal()">+ New Project</button>
        </div>

        <div class="projects-section">
            <div class="form-group" style="margin-bottom: 2rem;">
                <input type="text" id="searchInput" placeholder="Search projects..." onkeyup="filterProjects()" style="max-width: 400px;">
            </div>

            <div id="projectsContainer" class="projects-grid">
                <!-- Projects will be loaded here -->
            </div>

            <div id="emptyState" class="empty-state" style="display:none;">
                <div class="empty-icon">üìÅ</div>
                <h3>No Projects Yet</h3>
                <p>Create your first project to get started</p>
                <button class="btn-primary" onclick="openCreateModal()">Create Project</button>
            </div>
        </div>
    </div>

    <!-- Create Project Modal -->
    <div class="modal" id="createProjectModal">
        <div class="modal-content">
            <h3>Create New Project</h3>
            <form id="createProjectForm">
                <div class="form-group">
                    <input type="text" id="projectName" placeholder="Project Name" required>
                </div>
                <div class="form-group">
                    <textarea id="projectDescription" placeholder="Project Description" rows="3"></textarea>
                </div>
                <div class="modal-actions">
                    <button type="button" class="btn-outline" onclick="closeCreateModal()">Cancel</button>
                    <button type="submit" class="btn-primary">Create Project</button>
                </div>
            </form>
        </div>
    </div>

    <script src="/static/js/auth.js"></script>
    <script src="/static/js/api.js"></script>
    <script src="/static/js/notifications.js"></script>
    <script>
        let projects = [];
        const token = localStorage.getItem('token');

        // Check authentication
        if (!token) {
            window.location.href = '/login';
        }

        // Load projects on page load
        document.addEventListener('DOMContentLoaded', function() {
            loadProjects();
        });

        async function loadProjects() {
            try {
                const response = await fetch('/api/projects', {
                    headers: {
                        'Authorization': `Bearer ${token}`
                    }
                });

                if (response.ok) {
                    const data = await response.json();
                    projects = data.projects || [];
                } else {
                    // Demo projects for testing
                    projects = [
                        { id: 1, name: 'SynergySphere Platform', description: 'Main collaboration platform development', created_at: new Date().toISOString(), task_count: 8, member_count: 4 },
                        { id: 2, name: 'Mobile App', description: 'React Native mobile application', created_at: new Date(Date.now() - 86400000).toISOString(), task_count: 5, member_count: 2 },
                        { id: 3, name: 'API Documentation', description: 'Comprehensive API documentation and guides', created_at: new Date(Date.now() - 172800000).toISOString(), task_count: 3, member_count: 1 }
                    ];
                }
                displayProjects(projects);
            } catch (error) {
                console.error('Error loading projects:', error);
                // Demo projects for testing
                projects = [
                    { id: 1, name: 'SynergySphere Platform', description: 'Main collaboration platform development', created_at: new Date().toISOString(), task_count: 8, member_count: 4 },
                    { id: 2, name: 'Mobile App', description: 'React Native mobile application', created_at: new Date(Date.now() - 86400000).toISOString(), task_count: 5, member_count: 2 },
                    { id: 3, name: 'API Documentation', description: 'Comprehensive API documentation and guides', created_at: new Date(Date.now() - 172800000).toISOString(), task_count: 3, member_count: 1 }
                ];
                displayProjects(projects);
            }
        }

        function displayProjects(projectsToDisplay) {
            const container = document.getElementById('projectsContainer');
            const emptyState = document.getElementById('emptyState');

            if (projectsToDisplay.length === 0) {
                container.innerHTML = '';
                emptyState.style.display = 'block';
                return;
            }

            emptyState.style.display = 'none';
            container.innerHTML = projectsToDisplay.map(project => `
                <div class="project-card" onclick="viewProject(${project.id})">
                    <div class="project-header">
                        <h3>${project.name}</h3>
                        <div class="project-date">${new Date(project.created_at).toLocaleDateString()}</div>
                    </div>
                    <div class="project-description">${project.description || 'No description'}</div>
                    <div class="project-stats">
                        <div class="stat">üìã ${project.task_count || 0} tasks</div>
                        <div class="stat">üë• ${project.member_count || 0} members</div>
                    </div>
                </div>
            `).join('');
        }

        function filterProjects() {
            const searchTerm = document.getElementById('searchInput').value.toLowerCase();
            const filtered = projects.filter(project => 
                project.name.toLowerCase().includes(searchTerm) ||
                (project.description && project.description.toLowerCase().includes(searchTerm))
            );
            displayProjects(filtered);
        }

        function openCreateModal() {
            document.getElementById('createProjectModal').style.display = 'flex';
        }
        
        function closeCreateModal() {
            document.getElementById('createProjectModal').style.display = 'none';
            document.getElementById('createProjectForm').reset();
        }

        // Handle form submission
        document.getElementById('createProjectForm').addEventListener('submit', async function(e) {
            e.preventDefault();
            
            const name = document.getElementById('projectName').value;
            const description = document.getElementById('projectDescription').value;

            if (!name.trim()) {
                alert('Please enter a project name');
                return;
            }

            try {
                const response = await fetch('/api/projects', {
                    method: 'POST',
                    headers: {
                        'Content-Type': 'application/json',
                        'Authorization': `Bearer ${token}`
                    },
                    body: JSON.stringify({ name, description })
                });

                if (response.ok) {
                    closeCreateModal();
                    loadProjects();
                } else {
                    const error = await response.json();
                    alert(error.error || 'Failed to create project');
                }
            } catch (error) {
                console.error('Error creating project:', error);
                alert('Failed to create project');
            }
        });

        async function viewProject(projectId) {
            window.location.href = `/projects/${projectId}`;
        }

        function logout() {
            localStorage.removeItem('token');
            localStorage.removeItem('user');
            window.location.href = '/login';
        }
        
        // Close modal when clicking outside
        document.getElementById('createProjectModal').addEventListener('click', function(e) {
            if (e.target === this) {
                closeCreateModal();
            }
        });
    </script>
</body>
</html>
